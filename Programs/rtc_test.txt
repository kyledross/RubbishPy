' Real-time clock test
' Pre-requisites:
' Compiler at address 0
' Processor
' RTC at 1024

' Usage:
' python3 main.py --compiler address=0 size=1024 program=../Programs/rtc_test.txt --rtc address=2048 interrupt=7 --console width=80 height=25 address=1024 interrupt=2 --ram address=4096 size=1024 --processor

include ../Programs/Libraries/text_output_routines.txt
include ../Programs/Libraries/make_int_to_ascii.txt

' Setup RTC
call setup_rtc

' set interrupt vector
SIV 7 clock_tick
sleep

clock_tick:
' set destination RAM address
lr 8 4096

' get year from RTC
lrm 1 2050

call make_int_to_ascii
pop 8

' send dash
lr 1 32
mrm 1 1024

call send_cr_lf
pop 8

call terminate_string
pop 8

' setup and call print
lr 3 4096
call print_loop
rtn

setup_rtc:
' set UTC
' set whole
LR 1 -5
MRM 1 2048
' set fraction
LR 1 0
MRM 1 2049
rtn





